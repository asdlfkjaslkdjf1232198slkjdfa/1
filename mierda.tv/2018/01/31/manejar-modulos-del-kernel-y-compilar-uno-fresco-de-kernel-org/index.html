<!DOCTYPE html><html class="no-js" lang="es-ES"><head><meta http-equiv="content-type" content="text/html" charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" ><link rel="profile" href="http://gmpg.org/xfn/11"><link type="text/css" media="all" href="https://mierda.tv/wp-contenido/cache/autoptimize/css/autoptimize_dcbc99a7d03052a28dbf604173960da0.css" rel="stylesheet" /><title>Manejar módulos del Kernel y compilar uno fresco de kernel.org &#8211; [ MIERDA TV ]</title><link rel="alternate" type="application/rss+xml" title="[ MIERDA TV ] &raquo; Feed" href="https://mierda.tv/feed/" /><link rel="alternate" type="application/rss+xml" title="[ MIERDA TV ] &raquo; RSS de los comentarios" href="https://mierda.tv/comments/feed/" /><link rel="alternate" type="application/rss+xml" title="[ MIERDA TV ] &raquo; Manejar módulos del Kernel y compilar uno fresco de kernel.org RSS de los comentarios" href="https://mierda.tv/2018/01/31/manejar-modulos-del-kernel-y-compilar-uno-fresco-de-kernel-org/feed/" /><link rel='stylesheet' id='mcluhan-fonts-css'  href='https://fonts.googleapis.com/css?family=Archivo:400,400i,600,600i,700,700i&#038;subset=latin-ext' type='text/css' media='all' /> <script type='text/javascript' src='https://mierda.tv/wp-includes/js/jquery/jquery.js'></script> <link rel='https://api.w.org/' href='https://mierda.tv/wp-json/' /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://mierda.tv/xmlrpc.php?rsd" /><link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://mierda.tv/wp-includes/wlwmanifest.xml" /><link rel='prev' title='Tuberías, dobles tuberías, bifurcaciones y múltiples argumentos' href='https://mierda.tv/2018/01/31/tuberias-dobles-tuberias-bifurcaciones-y-multiples-argumentos/' /><link rel='next' title='Comandos curiosos y divertidos para GNU/Linux' href='https://mierda.tv/2018/01/31/comandos-curiosos-y-divertidos-para-gnu-linux/' /><meta name="generator" content="WordPress 4.9.8" /><link rel="canonical" href="https://mierda.tv/2018/01/31/manejar-modulos-del-kernel-y-compilar-uno-fresco-de-kernel-org/" /><link rel='shortlink' href='https://mierda.tv/?p=5686' /><link rel="alternate" type="application/json+oembed" href="https://mierda.tv/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmierda.tv%2F2018%2F01%2F31%2Fmanejar-modulos-del-kernel-y-compilar-uno-fresco-de-kernel-org%2F" /> <script>jQuery( 'html' ).removeClass( 'no-js' ).addClass( 'js' );</script> <link rel="icon" href="https://mierda.tv/wp-contenido/uploads/2017/12/favicon-1.png" type="image/png"/><link rel="shortcut icon" href="https://mierda.tv/wp-contenido/uploads/2017/12/favicon.png" /></head><body class="post-template-default single single-post postid-5686 single-format-standard"><header class="site-header group"><h1 class="site-title"><a href="https://mierda.tv" class="site-name">[ MIERDA TV ]</a></h1><p class="site-description">NSFW Fanta text files</p><div class="nav-toggle"><div class="bar"></div><div class="bar"></div></div><div class="menu-wrapper"><ul class="main-menu desktop"><li id="menu-item-9007" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-9007"><a href="https://mierda.tv/category/sistemas/"># SYSTEM</a></li><li id="menu-item-9006" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9006"><a href="https://mierda.tv/category/codigo/"># CODE</a></li><li id="menu-item-9008" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9008"><a href="https://mierda.tv/category/juegos/"># GAMES</a></li><li id="menu-item-9012" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9012"><a href="https://mierda.tv/category/3d/"># 3D</a></li><li id="menu-item-9011" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9011"><a href="https://mierda.tv/category/musica/"># MUSIC</a></li><li id="menu-item-9010" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9010"><a href="https://mierda.tv/category/opinion/"># VIEW</a></li></ul></div><ul class="social-menu desktop"><li><a href="https://mierda.tv/?s="></a></li><li id="menu-item-10588" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-10588"><a title="Suscríbete al Boletín mensual de Mierda.tv" href="https://mierda.tv/suscribete-al-boletin-mensual-de-mierda-tv/"><span class="screen-reader-text">Suscríbete al Boletín mensual de Mierda.tv</span></a></li></ul></header><div class="mobile-menu-wrapper"><ul class="main-menu mobile"><li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-9007"><a href="https://mierda.tv/category/sistemas/"># SYSTEM</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9006"><a href="https://mierda.tv/category/codigo/"># CODE</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9008"><a href="https://mierda.tv/category/juegos/"># GAMES</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9012"><a href="https://mierda.tv/category/3d/"># 3D</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9011"><a href="https://mierda.tv/category/musica/"># MUSIC</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9010"><a href="https://mierda.tv/category/opinion/"># VIEW</a></li><li class="toggle-mobile-search-wrapper"><a href="#" class="toggle-mobile-search">Buscar</a></li></ul><ul class="social-menu mobile"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-10588"><a title="Suscríbete al Boletín mensual de Mierda.tv" href="https://mierda.tv/suscribete-al-boletin-mensual-de-mierda-tv/"><span class="screen-reader-text">Suscríbete al Boletín mensual de Mierda.tv</span></a></li></ul></div><div class="mobile-search"><div class="untoggle-mobile-search"></div><form role="search" method="get" class="search-form" action="https://mierda.tv/"> <label for="search-form-5bab6029a7a18"> <span class="screen-reader-text">Búsqueda para:</span> </label> <input type="search" id="search-form-5bab6029a7a18" class="search-field" placeholder="Introduce tu búsqueda" value="" name="s" autocomplete="off" /> </button></form><div class="mobile-results"><div class="results-wrapper"></div></div></div><div class="search-overlay"><form role="search" method="get" class="search-form" action="https://mierda.tv/"> <label for="search-form-5bab6029a7ac2"> <span class="screen-reader-text">Búsqueda para:</span> </label> <input type="search" id="search-form-5bab6029a7ac2" class="search-field" placeholder="Introduce tu búsqueda" value="" name="s" autocomplete="off" /> </button></form></div><main class="site-content"><article class="post-5686 post type-post status-publish format-standard hentry category-sistemas missing-thumbnail"><header class="entry-header section-inner"><h1 class="entry-title">Manejar módulos del Kernel y compilar uno fresco de kernel.org</h2><div class="meta"> <time><a href="https://mierda.tv/2018/01/31/manejar-modulos-del-kernel-y-compilar-uno-fresco-de-kernel-org/" title="31 enero, 2018 2:14 am">31 enero, 2018</a></time> <span> En <a href="https://mierda.tv/category/sistemas/" rel="category tag"># SYSTEM</a> </span></div></header><div class="entry-content section-inner"><p>Los módulos del Kernel son piezas de código que pueden ser cargadas y descargadas en el kernel bajo demanda y sin la necesidad de reiniciar el sistema.</p><p>De esta forma <strong>la funcionalidad del Kernel Linux se extiende a través de módulos.</strong></p><p>Esos módulos pueden funcionar como drivers (controladores de hardware) o simplemente sumar al kernel una nueva función como por ejemplo un protocolo de red nuevo o soporte para un sistema de ficheros de por ejemplo discos duros de ordenadores Amiga.</p><p>En este post <strong>vamos a ver como podemos compilar el kernel</strong> a nuestro gusto no sin antes ver como manejar los módulos del kernel en nuestro sistema.</p><p><strong># Herramientas para manejar los módulos</strong></p><p>Estas herramientas es muy posible que ya las tengamos instalas en nuestro sistema ya que <strong>suelen venir en la mayoría de distros</strong> no obstante si no es así posiblemente las encontraremos en paquetes llamados: &#8220;module-init-tools&#8221; o &#8220;kmod&#8221;.</p><p>Estas herramientas son:</p><ul><li><strong>lsmod</strong> &#8211; Sirve para ver un listado de los módulos y el estado de estos en el Kernel.</li><li><strong>insmod</strong> &#8211; Para insertar un módulo en el kernel. Si depende de otros se han de cargar antes.</li><li><strong>modprobe</strong> &#8211; Sirve para cargar un módulo y los que dependan de él. Tiene más funciones, ver man modprobe.</li><li><strong>modinfo</strong> &#8211; Información en detalle de un módulo. Podemos ver en que directorio se encuentra por ejemplo.</li><li><strong>rmmod</strong> &#8211; Para eliminar un modulo incluso forzando su eliminación aunque esté en uso.</li><li><strong>depmod</strong> &#8211; Este se ejecuta al inicio. Nos sirve para establecer las dependencias entre módulos. Si alteramos la configuración manualmente es interesante ejecutarlo y cambiará /lib/modules/laversióndelkernel/modules.dep</li></ul><p>Sabremos que estamos ante un módulo del kernel posiblemente cuando vemos que un archivo tiene la <strong>extensión .ko</strong></p><p><strong># Probando las herramientas con un ratón usb óptico</strong></p><p>Si disponemos de un ratón USB podemos probar a enchufarlo y desenchufarlo y mirar con dmesg la información del kernel:</p><p>&nbsp;</p><pre>
# dmesg
</pre><p>&nbsp;</p><p>Con suerte veremos algo así como esto:</p><p><img src="https://mierda.tv/wp-contenido/uploads/2018/01/mouse.png" alt="" width="1365" height="296" class="alignnone size-full wp-image-5690" /></p><p>Por tanto podemos ver que el modulo hid depende de hid_generic y usbhid .<br /> Podemos obtener información de estos módulos con <strong>modinfo </strong>así:</p><pre>
# modinfo usbhid
</pre><p>Podemos comprobar su estado con <strong>lsmod</strong> así:</p><pre>
# lsmod | grep usbhid
</pre><p>Podemos usar<strong> modprobe</strong> para descargar el modulo o cargarlo:</p><pre>
# modprobe -r usbhid
# modprobe usbhid
</pre><p>En el momento que descargamos el modulo (-r remove) dejará de funcionar el ratón USB. Si lo cargamos regresará a la vida.</p><p>Otra opción es usar <strong>rmmod</strong> .</p><p>Si quisiéramos añadir a una lista negra un módulo podemos ver esta entrada en la que se habla de eso:</p><p><a href="https://mierda.tv/2018/01/30/desactivar-el-sonido-en-gnu-linux-u-otros-perifericos/">https://mierda.tv/2018/01/30/desactivar-el-sonido-en-gnu-linux-u-otros-perifericos/</a></p><p>Si añadiésemos a la lista usbhid pues el modulo no se cargaría si por ejemplo reiniciamos el sistema.</p><p>Ahora vamos ya a la chicha. Vamos a cocinar un kernel.</p><p><strong># Compilar un kernel</strong></p><p>Lo normal es compilar una nueva versión de un Kernel cuando necesitamos por algún motivo alguna de las mejoras que incorpore. Esto supone que por ejemplo queremos soporte para algún dispositivo más reciente que no tiene en la versión que utilizamos. Es posible también que simplemente nos de la gana <strong>tener un kernel más optimizado para nuestro hardware</strong> y que por eso queremos compilarlo en vez de bajar uno ya compilado de los repositorios de nuestra distro.</p><p>Vamos a ver nuestra versión de kernel:</p><pre>
# uname -r
</pre><p>En mi caso la 4.9.0-4-amd64 . Miramos en <a href="https://www.kernel.org/">https://www.kernel.org/</a> la última stable, actualmente a día de hoy la 4.15</p><p>La descargamos así (unos 97Mb):</p><pre>
# wget "https://cdn.kernel.org/pub/linux/kernel/v4.x/linux-4.15.tar.xz"
</pre><p>Como es un tar.xz lo descomprimiremos así:</p><pre>
# tar xvJf linux-4.15.tar.xz
</pre><p>Nos metemos en el directorio que se ha creado e <strong>instalaremos la dependencia libncurses</strong> ya que la requerimos para hacer uso de menuconfig (que es la opción que vamos a emplear para configurar las opciones del kernel).</p><p>En debian puede instalarse la dependencia así (y de paso otras que se requieren pero que es posible que tengas ya cumplidas):</p><pre>
# apt-get install libncurses5-dev fakeroot build-essential xz-utils libssl-dev bc
# cd linux-4.15
</pre><p>Una vez estamos en el directorio del kernel descomprimido vamos a realizar un limpiado con:</p><pre>
# make mrproper 
</pre><p>En realidad teóricamente tendría que venir limpio sin archivos de configuración pero mejor tomarlo como manía ya que si compilamos luego de nuevo tendríamos que limpiar antes.</p><p>Vamos a configurar:</p><pre>
# make menuconfig
</pre><p>Aquí navegaremos añadiendo que queremos que se cargue, lo que queremos cargar como modulo, etc&#8230;<br /> En mi caso por ejemplo quiero soporte para sistemas de fichero de discos duro de Amiga pero lo mismo a ti eso no te interesa y podrías no cargarlo.</p><p><img src="https://mierda.tv/wp-contenido/uploads/2018/01/amiga.png" alt="" width="1366" height="768" class="alignnone size-full wp-image-5697" /></p><p>Cuando tengas tu configuración lista sal guardando cambios. <strong>Es el momento de compilar.</strong></p><p>Voy a hacerlo a &#8220;la Debian way&#8221; ya que quiero tener el kernel compilado y las headers de este en paquetes deb. Esto es de tremenda utilidad para no andar compilando por ejemplo en otros ordenadores idénticos y para desinstalar de forma sencilla cuando tengamos otro kernel.</p><p>Es importante saber que en la versión estable quizás no encontremos kernel-package y por tanto no tendremos el comando make-kpkg pero puede usarse por ejemplo la versión de <a href="http://ftp.us.debian.org/debian/pool/main/k/kernel-package/kernel-package_13.018+nmu1_all.deb">sid</a>.</p><p>Es posible que necesitemos cumplir algunas dependencias que nos falten y es el momento de hacerlo claro.</p><pre>
# apt-get install libelf-dev
# make-kpkg clean
# make-kpkg --initrd kernel_image kernel_headers 
</pre><p>Vete un rato si quieres. Tardará un tiempo en cocinarse a fuego lento. El resultado han de ser 2 paquetes deb, uno con el kernel compilado y otro con las cabeceras.</p><p><img src="https://mierda.tv/wp-contenido/uploads/2018/01/kernel.png" alt="" width="1366" height="768" class="alignnone size-full wp-image-5700" /></p><p>Es interesante indicar con -j el número de cores con los que contamos para agilizar un poco la compilación: make-kpkg -j 2 &#8211;initrd kernel_image kernel_headers</p><p>Es importante disponer de bastantes gigas libres para compilar (lo menos 20Gb dependiendo de lo que activemos).</p><p>Finalmente cuando tengamos ya los paquetes deb los instalaremos con &#8220;dkpg -i nombrepaquete.deb&#8221;.<br /> Si todo va bien al reiniciar vamos a poder optar por este kernel y probarlo.</p><div class='rp4wp-related-posts'><h3>Más mierda posiblemente relacionada</h3><ul><li><div class='rp4wp-related-post-content'> <a href='https://mierda.tv/2018/07/27/compilar-nethack-3-6-2-0/'>Compilar Nethack 3.6.2-0</a><p>Nethack (aquí enlace a wikipedia) siempre está allí para comenzar a jugarlo. Sin imaginación no&hellip;</p></div></li><li><div class='rp4wp-related-post-content'> <a href='https://mierda.tv/2017/04/03/compilar-conversations-desde-gnulinux/'>Compilar Conversations desde GNU/Linux</a><p>Instalamos algunas dependencias: # apt-get install lib32z1 lib32ncurses5 libbz2-1.0 lib32stdc++6 libbz2-dev Descargar e instalar el&hellip;</p></div></li><li><div class='rp4wp-related-post-content'> <a href='https://mierda.tv/2018/07/17/crear-una-iso-booteable-con-un-kernel-linux-y-lo-minimo/'>Crear una iso booteable con un kernel Linux y lo mínimo</a><p>Instalamos dependencias (en debian): # apt-get install wget bc build-essential gawk xorriso qemu git Ahora&hellip;</p></div></li></ul></div></div><div class="post-pagination section-inner"><div class="previous-post"> <a href="https://mierda.tv/2018/01/31/tuberias-dobles-tuberias-bifurcaciones-y-multiples-argumentos/" rel="prev"><span>Tuberías, dobles tuberías, bifurcaciones y múltiples argumentos</span></a></div><div class="next-post"> <a href="https://mierda.tv/2018/01/31/comandos-curiosos-y-divertidos-para-gnu-linux/" rel="next"><span>Comandos curiosos y divertidos para GNU/Linux</span></a></div></div><div class="section-inner wide"><div class="comments"><h3 class="comment-reply-title">2 comentarios</h3><div class="comment even thread-even depth-1" id="li-comment-7778"><div id="comment-7778"><header class="comment-meta"> <span class="comment-author"> <cite> luispoo </cite> </span> <span class="comment-date"> <a class="comment-date-link" href="https://mierda.tv/2018/01/31/manejar-modulos-del-kernel-y-compilar-uno-fresco-de-kernel-org/#comment-7778" title="20 julio, 2018 a 5:46 pm">20 julio, 2018</a> </span> <span class="comment-reply"><a rel='nofollow' class='comment-reply-link' href='https://mierda.tv/2018/01/31/manejar-modulos-del-kernel-y-compilar-uno-fresco-de-kernel-org/?replytocom=7778#respond' onclick='return addComment.moveForm( "comment-7778", "7778", "respond", "5686" )' aria-label='Responder a luispoo'>Contestar</a></span></header><div class="comment-content entry-content"><p>Interesante exposición pero no dice nada de los múdulos firmados y el anillo de firmas del kernel para proceder a ello. Si tienes algún otro artículo relacionado con la firma de módulo, te rogaría me enviaras el enlace</p><p>Gracias por todo</p><p>luispoo</p></div><div class="comment-actions"></div></div><div class="comment byuser comment-author-mierda bypostauthor odd alt depth-2" id="li-comment-7779"><div id="comment-7779"><header class="comment-meta"> <span class="comment-author"> <cite> <a href='https://mierda.tv' rel='external nofollow' class='url'>mierda</a> </cite> <span class="comment-by-post-author"> (Autor)</span> </span> <span class="comment-date"> <a class="comment-date-link" href="https://mierda.tv/2018/01/31/manejar-modulos-del-kernel-y-compilar-uno-fresco-de-kernel-org/#comment-7779" title="20 julio, 2018 a 7:18 pm">20 julio, 2018</a> </span> <span class="comment-reply"><a rel='nofollow' class='comment-reply-link' href='https://mierda.tv/2018/01/31/manejar-modulos-del-kernel-y-compilar-uno-fresco-de-kernel-org/?replytocom=7779#respond' onclick='return addComment.moveForm( "comment-7779", "7779", "respond", "5686" )' aria-label='Responder a mierda'>Contestar</a></span></header><div class="comment-content entry-content"><p>Pues no tengo nada de lo que comentas :). Lo siento. Esto era básicamente un how to rápido.</p></div><div class="comment-actions"></div></div></div></div></div><div id="respond" class="comment-respond"><h3 id="reply-title" class="comment-reply-title">Deja un comentario <small><a rel="nofollow" id="cancel-comment-reply-link" href="/2018/01/31/manejar-modulos-del-kernel-y-compilar-uno-fresco-de-kernel-org/#respond" style="display:none;">Cancelar respuesta</a></small></h3><form action="https://mierda.tv/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><p class="comment-form-comment"><label for="comment">Comentario</label><textarea autocomplete="nope"  id="1d0613242b"  name="1d0613242b"   cols="45" rows="8" maxlength="65525" required="required"></textarea><textarea id="comment" aria-hidden="true" name="comment" autocomplete="nope" style="padding:0;clip:rect(1px, 1px, 1px, 1px);position:absolute !important;white-space:nowrap;height:1px;width:1px;overflow:hidden;" tabindex="-1"></textarea><script type="text/javascript">document.getElementById("comment").setAttribute( "id", "2518ef87a2b80c0d26ad0437b6869d56" );document.getElementById("1d0613242b").setAttribute( "id", "comment" );</script></p><p class="comment-form-author"><label for="author">Nombre <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" required='required' /></p><p class="comment-form-email"><label for="email">Correo electrónico <span class="required">*</span></label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" aria-describedby="email-notes" required='required' /></p><p class="comment-form-url"><label for="url">Web</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200" /></p><p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Publicar comentario" /> <input type='hidden' name='comment_post_ID' value='5686' id='comment_post_ID' /> <input type='hidden' name='comment_parent' id='comment_parent' value='0' /></p></form></div></div></div><footer class="site-footer section-inner"><p class="copyright">&copy; 2018 <a href="https://mierda.tv" class="site-name">[ MIERDA TV ]</a></p></footer></main> <script type="text/javascript">jQuery(document).ready( function() { jQuery.post( "https://mierda.tv/wp-admin/admin-ajax.php", { action : "entry_views", _ajax_nonce : "70537a5d8f", post_id : 5686 } ); } );</script> <script type='text/javascript'>var es_widget_page_notices = {"es_email_notice":"Por favor introduce direcci\u00f3n de correo electr\u00f3nico","es_success_message":"Suscripci\u00f3n correcta.","es_success_notice":"\u00a1Suscripci\u00f3n correcta! Consulta tu bandeja de entrada y confirma tu suscripci\u00f3n. Si no ves el correo en unos minutos, consulta la carpeta spam\/correo no deseado.","es_email_exists":"\u00a1Esa direcci\u00f3n de correo electr\u00f3nico ya existe!","es_error":"Ups. Ha sucedido un error inesperado.","es_invalid_email":"Direcci\u00f3n de correo electr\u00f3nico no v\u00e1lida","es_try_later":"Por favor, int\u00e9ntalo transcurridos unos minutos","es_ajax_url":"https:\/\/mierda.tv\/wp-admin\/admin-ajax.php"};</script> <script type='text/javascript'>var mcluhan_ajaxpagination = {"ajaxurl":"https:\/\/mierda.tv\/wp-admin\/admin-ajax.php","query_vars":"{\"page\":\"\",\"year\":\"2018\",\"monthnum\":\"01\",\"day\":\"31\",\"name\":\"manejar-modulos-del-kernel-y-compilar-uno-fresco-de-kernel-org\"}"};</script> <script type="text/javascript" defer src="https://mierda.tv/wp-contenido/cache/autoptimize/js/autoptimize_0f440c40192207511c15447e1fc97710.js"></script></body></html>