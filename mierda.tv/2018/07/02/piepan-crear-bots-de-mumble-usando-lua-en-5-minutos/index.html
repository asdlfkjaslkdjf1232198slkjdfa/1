<!DOCTYPE html><html class="no-js" lang="es-ES"><head><meta http-equiv="content-type" content="text/html" charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" ><link rel="profile" href="http://gmpg.org/xfn/11"><link type="text/css" media="all" href="https://mierda.tv/wp-contenido/cache/autoptimize/css/autoptimize_dcbc99a7d03052a28dbf604173960da0.css" rel="stylesheet" /><title>Piepan &#8211; Crear bots de mumble en 5 minutos usando Lua &#8211; [ MIERDA TV ]</title><link rel="alternate" type="application/rss+xml" title="[ MIERDA TV ] &raquo; Feed" href="https://mierda.tv/feed/" /><link rel="alternate" type="application/rss+xml" title="[ MIERDA TV ] &raquo; RSS de los comentarios" href="https://mierda.tv/comments/feed/" /><link rel="alternate" type="application/rss+xml" title="[ MIERDA TV ] &raquo; Piepan &#8211; Crear bots de mumble en 5 minutos usando Lua RSS de los comentarios" href="https://mierda.tv/2018/07/02/piepan-crear-bots-de-mumble-usando-lua-en-5-minutos/feed/" /><link rel='stylesheet' id='mcluhan-fonts-css'  href='https://fonts.googleapis.com/css?family=Archivo:400,400i,600,600i,700,700i&#038;subset=latin-ext' type='text/css' media='all' /> <script type='text/javascript' src='https://mierda.tv/wp-includes/js/jquery/jquery.js'></script> <link rel='https://api.w.org/' href='https://mierda.tv/wp-json/' /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://mierda.tv/xmlrpc.php?rsd" /><link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://mierda.tv/wp-includes/wlwmanifest.xml" /><link rel='prev' title='Convertir archivos de mayúsculas a minúsculas, hombres y viceversa' href='https://mierda.tv/2018/07/01/convertir-archivos-de-mayusculas-a-minusculas-hombres-y-viceversa/' /><link rel='next' title='ecwolf &#8211; Wolfenstein 3D en GNU/Linux' href='https://mierda.tv/2018/07/03/ecwolf-wolfenstein-3d-en-gnu-linux/' /><meta name="generator" content="WordPress 4.9.8" /><link rel="canonical" href="https://mierda.tv/2018/07/02/piepan-crear-bots-de-mumble-usando-lua-en-5-minutos/" /><link rel='shortlink' href='https://mierda.tv/?p=8465' /><link rel="alternate" type="application/json+oembed" href="https://mierda.tv/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmierda.tv%2F2018%2F07%2F02%2Fpiepan-crear-bots-de-mumble-usando-lua-en-5-minutos%2F" /> <script>jQuery( 'html' ).removeClass( 'no-js' ).addClass( 'js' );</script> <link rel="icon" href="https://mierda.tv/wp-contenido/uploads/2017/12/favicon-1.png" type="image/png"/><link rel="shortcut icon" href="https://mierda.tv/wp-contenido/uploads/2017/12/favicon.png" /></head><body class="post-template-default single single-post postid-8465 single-format-standard"><header class="site-header group"><h1 class="site-title"><a href="https://mierda.tv" class="site-name">[ MIERDA TV ]</a></h1><p class="site-description">NSFW Fanta text files</p><div class="nav-toggle"><div class="bar"></div><div class="bar"></div></div><div class="menu-wrapper"><ul class="main-menu desktop"><li id="menu-item-9007" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9007"><a href="https://mierda.tv/category/sistemas/"># SYSTEM</a></li><li id="menu-item-9006" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-9006"><a href="https://mierda.tv/category/codigo/"># CODE</a></li><li id="menu-item-9008" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9008"><a href="https://mierda.tv/category/juegos/"># GAMES</a></li><li id="menu-item-9012" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9012"><a href="https://mierda.tv/category/3d/"># 3D</a></li><li id="menu-item-9011" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9011"><a href="https://mierda.tv/category/musica/"># MUSIC</a></li><li id="menu-item-9010" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9010"><a href="https://mierda.tv/category/opinion/"># VIEW</a></li></ul></div><ul class="social-menu desktop"><li><a href="https://mierda.tv/?s="></a></li><li id="menu-item-10588" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-10588"><a title="Suscríbete al Boletín mensual de Mierda.tv" href="https://mierda.tv/suscribete-al-boletin-mensual-de-mierda-tv/"><span class="screen-reader-text">Suscríbete al Boletín mensual de Mierda.tv</span></a></li></ul></header><div class="mobile-menu-wrapper"><ul class="main-menu mobile"><li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9007"><a href="https://mierda.tv/category/sistemas/"># SYSTEM</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-9006"><a href="https://mierda.tv/category/codigo/"># CODE</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9008"><a href="https://mierda.tv/category/juegos/"># GAMES</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9012"><a href="https://mierda.tv/category/3d/"># 3D</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9011"><a href="https://mierda.tv/category/musica/"># MUSIC</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9010"><a href="https://mierda.tv/category/opinion/"># VIEW</a></li><li class="toggle-mobile-search-wrapper"><a href="#" class="toggle-mobile-search">Buscar</a></li></ul><ul class="social-menu mobile"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-10588"><a title="Suscríbete al Boletín mensual de Mierda.tv" href="https://mierda.tv/suscribete-al-boletin-mensual-de-mierda-tv/"><span class="screen-reader-text">Suscríbete al Boletín mensual de Mierda.tv</span></a></li></ul></div><div class="mobile-search"><div class="untoggle-mobile-search"></div><form role="search" method="get" class="search-form" action="https://mierda.tv/"> <label for="search-form-5bab5fec51fd4"> <span class="screen-reader-text">Búsqueda para:</span> </label> <input type="search" id="search-form-5bab5fec51fd4" class="search-field" placeholder="Introduce tu búsqueda" value="" name="s" autocomplete="off" /> </button></form><div class="mobile-results"><div class="results-wrapper"></div></div></div><div class="search-overlay"><form role="search" method="get" class="search-form" action="https://mierda.tv/"> <label for="search-form-5bab5fec5206c"> <span class="screen-reader-text">Búsqueda para:</span> </label> <input type="search" id="search-form-5bab5fec5206c" class="search-field" placeholder="Introduce tu búsqueda" value="" name="s" autocomplete="off" /> </button></form></div><main class="site-content"><article class="post-8465 post type-post status-publish format-standard hentry category-codigo tag-lua tag-mumble-bot missing-thumbnail"><header class="entry-header section-inner"><h1 class="entry-title">Piepan &#8211; Crear bots de mumble en 5 minutos usando Lua</h2><div class="meta"> <time><a href="https://mierda.tv/2018/07/02/piepan-crear-bots-de-mumble-usando-lua-en-5-minutos/" title="2 julio, 2018 7:00 am">2 julio, 2018</a></time> <span> En <a href="https://mierda.tv/category/codigo/" rel="category tag"># CODE</a> </span></div></header><div class="entry-content section-inner"><p>Piepan está escrito en go pero eso nos da igual. La finalidad del programa para línea de comandos <em>&#8220;piepan&#8221;</em> es la de conectar a un servidor mumble ejecutando un script que programemos en Lua. Es por tanto lo que hagamos en Lua lo que determinará que hace el bot (un trivial, graba conversaciones del chat, graba el audio, transcribe el texto y lo sintetiza para reproducirlo como voz, &#8230;).</p><p>Es muy sencillo comenzar a hacer un bot. Básicamente necesitamos compilar piepan y luego ejecutarlo con algún ejemplo que he preparado (o uno que te programes tú)</p><p><strong>Instalar mumble-server</strong> en un servidor o en nuestra maquina en local (en debian 9, en otros sistemas pues cambiará un poco la cosa):</p><pre>
# apt-get install mumble-server
# dpkg-reconfigure mumble-server 
</pre><p><strong>Compilar piepan en la maquina</strong> en el que tenemos mumble server instalado:</p><pre>
# apt-get install -y git libopus-dev wget software-properties-common pkg-config gcc libav-tools golang
$ export GOPATH=$(mktemp -d)
$ echo $GOPATH
$ go get -u layeh.com/piepan
$ go build -o piepan $GOPATH/src/layeh.com/piepan/cmd/piepan/main.go
</pre><p>Tendremos ya un archivo llamado piepan. Para conectarlo al server mumble podemos hacerlo así:</p><pre>
$ ./piepan -ffmpeg=avconv -insecure=true -username=bot
</pre><p><img src="https://mierda.tv/wp-contenido/uploads/2018/06/bot.png" alt="" width="214" height="215" class="alignnone size-full wp-image-8467" /></p><p>No realizará nada pero estará conectado. La sintaxis es esta:  ./piepan [options] [script files]<br /> <strong>Eso quiere decir que hemos de pasarle un argumento más que es el script escrito en Lua que queremos que haga cosas.</strong></p><p>Por ejemplo creamos un archivo llamado <strong>espiandochat.lua</strong> con este contenido:</p><p><img src="https://mierda.tv/wp-contenido/uploads/2018/06/codigo.png" alt="" width="809" height="364" class="alignnone size-full wp-image-8468" /></p><pre>
function mostrarFechaHoraInicio()
        fecha = os.date("%d/%m/%Y")
        hora = os.date("%H:%M:%S")
        print("Conectado el " .. fecha .. " a las " .. hora)
end

piepan.On("connect", function()
        mostrarFechaHoraInicio()
end)

piepan.On("message", function(m)
        -- Guardamos lo que se diga en el chat en el archivo chat.log
        file = io.open("chat.log", "a")
        file:write(fecha .. " " .. hora .. " - " .. m.Message .. "\n")
        -- Descomentando la siguiente línea se realizará un eco en la sala del mensaje
        --m.Sender:Send(m.Message)
        -- Descomentando la siguiente línea se imprimirá en el terminal el mensaje
        --print(m.Message)
end)

</pre><p>Y lo ejecutamos así:</p><pre>
$ ./piepan -ffmpeg=avconv -insecure=true -username=bot espiandochat.lua 
</pre><p><img src="https://mierda.tv/wp-contenido/uploads/2018/06/lua-bot-mumble.png" alt="" width="960" height="886" class="alignnone size-full wp-image-8469" /></p><p>Lo cierto es que se tendría que ejecutar la funcion de la hora y fecha abajo para que saliese cada vez actualizada, pero se me ha olvidado. Como ejemplo vale igual.</p><p>Ese ejemplo<strong> permite grabar conversaciones</strong> de chat en mumble.</p><p>Más información aquí: <a href="https://github.com/layeh/piepan">https://github.com/layeh/piepan</a></p><p>Es un ejemplo para ver la potencia. Con ese ejemplo vemos que podemos almacenar lo que se dice en un chat pero también podemos mandar algo si evaluamos con un if lo que alguien dice. Si por ejemplo alguien dice&#8221; hola&#8221; comprobaríamos si m.Message es == &#8220;hola&#8221; y  entonces hacemos lo que queramos. Por ejemplo responder con un saludo aleatorio en plan: buenos días o buenas noches (comprobando la hora).</p><p>Algo más avanzado es poder responder hablando con conversaciones en wav pregrabadas. Si dice hola le contestamos con saludo.wav que hablará con una voz que podemos sacar de cualquier película y dirá &#8220;hola amigo&#8221;.</p><p>Como se puede ver esto da mucha vida y permite hacer cosas muy molonas.</p><p>Saludos cordiales.</p><div class='rp4wp-related-posts'><h3>Más mierda posiblemente relacionada</h3><ul><li><div class='rp4wp-related-post-content'> <a href='https://mierda.tv/2018/02/28/gnusocial-install-party-virtual-en-mumble-domingo-4-marzo-2018/'>GNUSocial Install Party en mumble - Domingo 4 Marzo 2018</a><p>La idea es dejar documentado el proceso de instalación de un nodo GNUSocial así como&hellip;</p></div></li><li><div class='rp4wp-related-post-content'> <a href='https://mierda.tv/2017/12/19/publicar-estados-en-gnusocial-desde-un-script-en-lua/'>Publicar estados en GNUsocial desde un script en Lua</a><p>En el anterior post se explica como se puede instalar lua en GNU/Linux y la&hellip;</p></div></li><li><div class='rp4wp-related-post-content'> <a href='https://mierda.tv/2018/01/14/lua-concatenar-2-archivos/'>Lua - Concatenar 2 archivos</a><p>En una anterior entrada se ha visto un ejemplo de código en Lua que nos&hellip;</p></div></li></ul></div></div><div class="meta bottom section-inner"><p class="tags"> #<a href="https://mierda.tv/tag/lua/" rel="tag">LUA</a> #<a href="https://mierda.tv/tag/mumble-bot/" rel="tag">mumble bot</a></p></div><div class="post-pagination section-inner"><div class="previous-post"> <a href="https://mierda.tv/2018/07/01/convertir-archivos-de-mayusculas-a-minusculas-hombres-y-viceversa/" rel="prev"><span>Convertir archivos de mayúsculas a minúsculas, hombres y viceversa</span></a></div><div class="next-post"> <a href="https://mierda.tv/2018/07/03/ecwolf-wolfenstein-3d-en-gnu-linux/" rel="next"><span>ecwolf &#8211; Wolfenstein 3D en GNU/Linux</span></a></div></div><div class="section-inner wide"><div id="respond" class="comment-respond"><h3 id="reply-title" class="comment-reply-title">Deja un comentario <small><a rel="nofollow" id="cancel-comment-reply-link" href="/2018/07/02/piepan-crear-bots-de-mumble-usando-lua-en-5-minutos/#respond" style="display:none;">Cancelar respuesta</a></small></h3><form action="https://mierda.tv/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><p class="comment-form-comment"><label for="comment">Comentario</label><textarea autocomplete="nope"  id="9276fb9bfd"  name="9276fb9bfd"   cols="45" rows="8" maxlength="65525" required="required"></textarea><textarea id="comment" aria-hidden="true" name="comment" autocomplete="nope" style="padding:0;clip:rect(1px, 1px, 1px, 1px);position:absolute !important;white-space:nowrap;height:1px;width:1px;overflow:hidden;" tabindex="-1"></textarea><script type="text/javascript">document.getElementById("comment").setAttribute( "id", "03392a40f573d5850ffe87641b443cbf" );document.getElementById("9276fb9bfd").setAttribute( "id", "comment" );</script></p><p class="comment-form-author"><label for="author">Nombre <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" required='required' /></p><p class="comment-form-email"><label for="email">Correo electrónico <span class="required">*</span></label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" aria-describedby="email-notes" required='required' /></p><p class="comment-form-url"><label for="url">Web</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200" /></p><p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Publicar comentario" /> <input type='hidden' name='comment_post_ID' value='8465' id='comment_post_ID' /> <input type='hidden' name='comment_parent' id='comment_parent' value='0' /></p></form></div></div></div><footer class="site-footer section-inner"><p class="copyright">&copy; 2018 <a href="https://mierda.tv" class="site-name">[ MIERDA TV ]</a></p></footer></main> <script type="text/javascript">jQuery(document).ready( function() { jQuery.post( "https://mierda.tv/wp-admin/admin-ajax.php", { action : "entry_views", _ajax_nonce : "70537a5d8f", post_id : 8465 } ); } );</script> <script type='text/javascript'>var es_widget_page_notices = {"es_email_notice":"Por favor introduce direcci\u00f3n de correo electr\u00f3nico","es_success_message":"Suscripci\u00f3n correcta.","es_success_notice":"\u00a1Suscripci\u00f3n correcta! Consulta tu bandeja de entrada y confirma tu suscripci\u00f3n. Si no ves el correo en unos minutos, consulta la carpeta spam\/correo no deseado.","es_email_exists":"\u00a1Esa direcci\u00f3n de correo electr\u00f3nico ya existe!","es_error":"Ups. Ha sucedido un error inesperado.","es_invalid_email":"Direcci\u00f3n de correo electr\u00f3nico no v\u00e1lida","es_try_later":"Por favor, int\u00e9ntalo transcurridos unos minutos","es_ajax_url":"https:\/\/mierda.tv\/wp-admin\/admin-ajax.php"};</script> <script type='text/javascript'>var mcluhan_ajaxpagination = {"ajaxurl":"https:\/\/mierda.tv\/wp-admin\/admin-ajax.php","query_vars":"{\"page\":\"\",\"year\":\"2018\",\"monthnum\":\"07\",\"day\":\"02\",\"name\":\"piepan-crear-bots-de-mumble-usando-lua-en-5-minutos\"}"};</script> <script type="text/javascript" defer src="https://mierda.tv/wp-contenido/cache/autoptimize/js/autoptimize_0f440c40192207511c15447e1fc97710.js"></script></body></html>