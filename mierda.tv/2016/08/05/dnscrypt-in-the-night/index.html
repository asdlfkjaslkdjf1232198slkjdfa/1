<!DOCTYPE html><html class="no-js" lang="es-ES"><head><meta http-equiv="content-type" content="text/html" charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" ><link rel="profile" href="http://gmpg.org/xfn/11"><link type="text/css" media="all" href="https://mierda.tv/wp-contenido/cache/autoptimize/css/autoptimize_dcbc99a7d03052a28dbf604173960da0.css" rel="stylesheet" /><title>Dnscrypt in the night &#8211; [ MIERDA TV ]</title><link rel="alternate" type="application/rss+xml" title="[ MIERDA TV ] &raquo; Feed" href="https://mierda.tv/feed/" /><link rel="alternate" type="application/rss+xml" title="[ MIERDA TV ] &raquo; RSS de los comentarios" href="https://mierda.tv/comments/feed/" /><link rel="alternate" type="application/rss+xml" title="[ MIERDA TV ] &raquo; Dnscrypt in the night RSS de los comentarios" href="https://mierda.tv/2016/08/05/dnscrypt-in-the-night/feed/" /><link rel='stylesheet' id='mcluhan-fonts-css'  href='https://fonts.googleapis.com/css?family=Archivo:400,400i,600,600i,700,700i&#038;subset=latin-ext' type='text/css' media='all' /> <script type='text/javascript' src='https://mierda.tv/wp-includes/js/jquery/jquery.js'></script> <link rel='https://api.w.org/' href='https://mierda.tv/wp-json/' /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://mierda.tv/xmlrpc.php?rsd" /><link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://mierda.tv/wp-includes/wlwmanifest.xml" /><link rel='prev' title='10 reacciones de administradores/as de sistemas' href='https://mierda.tv/2016/08/04/10-reacciones-de-administradoresas-de-sistemas/' /><link rel='next' title='Rdesktop &#8211; Control remoto de máquinas windows' href='https://mierda.tv/2016/08/05/rdesktop-control-remoto-de-maquinas-windows/' /><meta name="generator" content="WordPress 4.9.8" /><link rel="canonical" href="https://mierda.tv/2016/08/05/dnscrypt-in-the-night/" /><link rel='shortlink' href='https://mierda.tv/?p=466' /><link rel="alternate" type="application/json+oembed" href="https://mierda.tv/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fmierda.tv%2F2016%2F08%2F05%2Fdnscrypt-in-the-night%2F" /> <script>jQuery( 'html' ).removeClass( 'no-js' ).addClass( 'js' );</script> <link rel="icon" href="https://mierda.tv/wp-contenido/uploads/2017/12/favicon-1.png" type="image/png"/><link rel="shortcut icon" href="https://mierda.tv/wp-contenido/uploads/2017/12/favicon.png" /></head><body class="post-template-default single single-post postid-466 single-format-standard"><header class="site-header group"><h1 class="site-title"><a href="https://mierda.tv" class="site-name">[ MIERDA TV ]</a></h1><p class="site-description">NSFW Fanta text files</p><div class="nav-toggle"><div class="bar"></div><div class="bar"></div></div><div class="menu-wrapper"><ul class="main-menu desktop"><li id="menu-item-9007" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-9007"><a href="https://mierda.tv/category/sistemas/"># SYSTEM</a></li><li id="menu-item-9006" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9006"><a href="https://mierda.tv/category/codigo/"># CODE</a></li><li id="menu-item-9008" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9008"><a href="https://mierda.tv/category/juegos/"># GAMES</a></li><li id="menu-item-9012" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9012"><a href="https://mierda.tv/category/3d/"># 3D</a></li><li id="menu-item-9011" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9011"><a href="https://mierda.tv/category/musica/"># MUSIC</a></li><li id="menu-item-9010" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9010"><a href="https://mierda.tv/category/opinion/"># VIEW</a></li></ul></div><ul class="social-menu desktop"><li><a href="https://mierda.tv/?s="></a></li><li id="menu-item-10588" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-10588"><a title="Suscríbete al Boletín mensual de Mierda.tv" href="https://mierda.tv/suscribete-al-boletin-mensual-de-mierda-tv/"><span class="screen-reader-text">Suscríbete al Boletín mensual de Mierda.tv</span></a></li></ul></header><div class="mobile-menu-wrapper"><ul class="main-menu mobile"><li class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-9007"><a href="https://mierda.tv/category/sistemas/"># SYSTEM</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9006"><a href="https://mierda.tv/category/codigo/"># CODE</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9008"><a href="https://mierda.tv/category/juegos/"># GAMES</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9012"><a href="https://mierda.tv/category/3d/"># 3D</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9011"><a href="https://mierda.tv/category/musica/"># MUSIC</a></li><li class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-9010"><a href="https://mierda.tv/category/opinion/"># VIEW</a></li><li class="toggle-mobile-search-wrapper"><a href="#" class="toggle-mobile-search">Buscar</a></li></ul><ul class="social-menu mobile"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-10588"><a title="Suscríbete al Boletín mensual de Mierda.tv" href="https://mierda.tv/suscribete-al-boletin-mensual-de-mierda-tv/"><span class="screen-reader-text">Suscríbete al Boletín mensual de Mierda.tv</span></a></li></ul></div><div class="mobile-search"><div class="untoggle-mobile-search"></div><form role="search" method="get" class="search-form" action="https://mierda.tv/"> <label for="search-form-5bab61409c371"> <span class="screen-reader-text">Búsqueda para:</span> </label> <input type="search" id="search-form-5bab61409c371" class="search-field" placeholder="Introduce tu búsqueda" value="" name="s" autocomplete="off" /> </button></form><div class="mobile-results"><div class="results-wrapper"></div></div></div><div class="search-overlay"><form role="search" method="get" class="search-form" action="https://mierda.tv/"> <label for="search-form-5bab61409c3e8"> <span class="screen-reader-text">Búsqueda para:</span> </label> <input type="search" id="search-form-5bab61409c3e8" class="search-field" placeholder="Introduce tu búsqueda" value="" name="s" autocomplete="off" /> </button></form></div><main class="site-content"><article class="post-466 post type-post status-publish format-standard hentry category-sistemas tag-cifrar-peticiones-dns tag-dnscrypt tag-dnscrypt-howto missing-thumbnail"><header class="entry-header section-inner"><h1 class="entry-title">Dnscrypt in the night</h2><div class="meta"> <time><a href="https://mierda.tv/2016/08/05/dnscrypt-in-the-night/" title="5 agosto, 2016 1:14 am">5 agosto, 2016</a></time> <span> En <a href="https://mierda.tv/category/sistemas/" rel="category tag"># SYSTEM</a> </span></div></header><div class="entry-content section-inner"><p><strong>Cifrar las peticiones DNS es un paso más.</strong> Cifrar las peticiones DNS solamente supone eso, que cada vez que solicitemos <a href="https://duckduckgo.com/">duckduckgo.com</a> la petición para saber en que IP anda ese dominio no se realice en plano.<br /> Web del proyecto: <a href="https://dnscrypt.org/">https://dnscrypt.org/</a><br /> En este articulillo veremos como podemos montar un server dnscrypt y también el cliente.</p><h3>Instalación de dependencias</h3><p>En debian 8 podemos <strong>instalar</strong> las dependencias así:</p><pre># apt-get update
# apt-get install git autoconf libsodium-dev libevent-dev dnsutils gcc bind9 ntpdate</pre><p>Una vez tengamos las dependencias instaladas vamos a <strong>crear un par de directorios</strong>:</p><pre>$ mkdir dnscrypt
$ cd dnscrypt
$ mkdir dnscrypt-server dnscrypt-client keys-and-certs</pre><p>&nbsp;</p><h3>Compilar servidor dnscrypt</h3><p>Necesitamos una maquina donde instalar dnscrypt server. En esa maquina compilaremos la última versión de dnscrypt server.<br /> La versión estable de dnscrypt server es la 0.2.1 a fecha de hoy 5 de Agosto del 2016.</p><p>Este es el repositorio git: <a href="https://github.com/Cofyc/dnscrypt-wrapper">https://github.com/Cofyc/dnscrypt-wrapper</a><br /> El proceso para compilarlo e instalarlo en el sistema es este:</p><pre>$ cd dnscrypt-server
$ git clone https://github.com/Cofyc/dnscrypt-wrapper
$ make configure
$ ./configure
$ make
$ make install</pre><p>Ya tenemos instalado dnscrypt server en la maquina que queremos que haga de servidor. Esto no quiere decir que funcione aún la cosa.</p><p>&nbsp;</p><h3>Compilar cliente dnscrypt</h3><p>El cliente se llama dnscrypt-proxy y podemos instalarlo también en la maquina servidor para hacer pruebas.<br /> Lo ideal es que dnscrypt-proxy lo instalemos en los ordenadores que queramos se conecten al servidor dnscrypt.<br /> Esto ya lo explicaremos luego. Ahora lo importante es saber como compilar dnscryp-proxy (el cliente).<br /> <a href="https://download.dnscrypt.org/dnscrypt-proxy/">La versión estable</a> del cliente dnscrypt es la 1.7.0 a fecha de hoy 2 de noviembre del 2015.</p><p>&nbsp;</p><p>Podemos bajar esta versión desde aquí: <a href="http://download.dnscrypt.org/dnscrypt-proxy/dnscrypt-proxy-1.6.0.tar.gz">http://download.dnscrypt.org/dnscrypt-proxy/dnscrypt-proxy-1.6.0.tar.gz</a></p><pre>$ cd ..
$ cd dnscrypt-client
$ wget http://download.dnscrypt.org/dnscrypt-proxy/dnscrypt-proxy-1.6.0.tar.gz
$ tar xfvz dnscrypt-proxy-1.6.0.tar.gz
$ rm -rf dnscrypt-proxy-1.6.0.tar.gz
$ mv dnscrypt-proxy-1.6.0/* .
$ rm -rf dnscrypt-proxy-1.6.0
$ ./configure
$ make
# make install</pre><p>&nbsp;</p><p>Ya tenemos compilado dnscryp cliente (el proxy) e instalado en el sistema.</p><h3></h3><h3>Comprobar las versiones</h3><p>Ahora es el momento de<strong> comprobar las versiones</strong> tanto del servidor (dnscrypt-wrapper) como del cliente (dnscrypt-proxy).<br /> Esto<strong> se puede realizar de forma sencilla</strong> desde la línea de comandos como root así para ver la versión del server:</p><pre># dnscrypt-wrapper --version</pre><p>Tendríamos que ver algo así como esto: dnscrypt-wrapper 0.2-14.g2cf8ecf<br /> Y para ver la versión del cliente así:</p><pre># dnscrypt-proxy --version</pre><p>Saldrá algo así como esto: dnscrypt-proxy 1.6.0</p><h3>Generación de claves y certificados</h3><p>Generamos el par de llaves de proveedor:</p><pre># cd ..
# cd keys-and-certs
# dnscrypt-wrapper --gen-provider-keypair</pre><p>Esto generará 2 archivos: <strong>public.key</strong> y<strong> secret.key</strong>.<br /> Nos mostrará un ejemplo de lo que han de usar los clientes que utilicen nuestro servicio.<br /> Nos mostrará también el fingerpint, no obstante también podemos sacarlo así cuando queramos:</p><pre># dnscrypt-wrapper --show-provider-publickey-fingerprint</pre><p>Ese chorro se lo pasaremos a quienes quieran conectar o lo publicaremos en algún lado para que la gente conozca la huella del server.<br /> Ya tenemos las llaves de proveedor. Ahora vamos a <strong>crear llaves de tiempo limitado</strong> para<strong> cifrar las peticiones DNS</strong>.<br /> Generaremos una llave y un certificado que podrán ser actualizados cuando nos de la real gana sin requerir al cliente o a los clientes cambiar su configuración/ones.<br /> Esto lo generaremos así:</p><pre># dnscrypt-wrapper --gen-crypt-keypair --crypt-secretkey-file=1.key</pre><p>Tendremos un archivo llamado <strong>1.key</strong><br /> Ahora vamos a generar el certificado:</p><pre># dnscrypt-wrapper --gen-cert-file --crypt-secretkey-file=1.key --provider-cert-file=1.cert</pre><p>&nbsp;</p><p>Nos guardará un archivo llamado <strong>1.cert</strong><br /> Haciendo un ls tendríamos que ver <strong>4</strong> archivos:</p><ul><li>1.cert</li><li>1.key</li><li>public.key</li><li>secret.key</li></ul><p>&nbsp;</p><h3>Iniciar servidor</h3><p>Ahora viene la parte bonita. Vamos a iniciar el servidor indicando un servidor dns en –resolver-address como por ejemplo 8.8.8.8 (cuidado que es de google. Para probar esta bien, pero mejor buscar otros).<br /> Un ejemplo de como iniciarlo que hemos de adaptar a nuestras condiciones es este:</p><pre># dnscrypt-wrapper -VVV --resolver-address=8.8.8.8:53 --listen-address=127.0.0.2:443 --provider-name=2.dnscrypt-cert.bash-street-boys-and-girls.com --crypt-secretkey-file=1.key --provider-cert-file=1.cert</pre><p>Es importante poner en –provider-name 2.dnscrypt-cert. y luego por ejemplo tu dominio. En el caso del ejemplo queda así: <em>2.dnscrypt-cert.bash-street-boys-and-girls.com</em></p><p>&nbsp;</p><h3>Comprobar que el servidor resuelve</h3><p><strong>Lo primero es ver que la hora esta sincronizada.</strong> <strong>Es importante para que no tengamos problemas con el certificado.</strong></p><p>En debian podemos usar dpkg-reconfigure tzdata y por ejemplo <em>ntpdate -u 1.europe.pool.ntp.org</em> para sincronizar la hora.<br /> Como tenemos en el server también dnscrypt-proxy vamos a probar a montar el proxy así por ejemplo:</p><pre># dnscrypt-proxy --local-address=127.0.0.2:53 --resolver-address=127.0.0.2:443 --provider-name=2.dnscrypt-cert.bash-street-boys-and-girls.com --provider-key=B67F:1944:2110:E41F:542C:CB37:5D01:5A83:E793:2B91:45AA:5DE8:7E23:3317:1855:BC53</pre><p>Esto es buena cosa. Ahora con dig probaremos a ver si nos resuelve:</p><pre># dig -p 53 mierda.tv @127.0.0.2</pre><p>Si nos resuelve es que todo va bien :). Si tienes problemas revisa la hora del sistema, revisa que le metes la fingerprint (huella) adecuada ya que es fácil meter la que no es. Recuerda añadir en /etc/resolv.conf nameserver 127.0.0.2</p><p>Para probar eso esta bien pero finalmente si quisiéramos ofrecerlo hacia el exterior tendríamos que poner dnscrypt-wrapper con algo como esto (modifica lo que tengas que modificar para que se adapte a tu configuración):</p><pre># dnscrypt-wrapper -VVV --resolver-address=8.8.8.8:53 --listen-address=37.228.134.139:443 --provider-name=2.dnscrypt-cert.bash-street-boys-and-girls.com --crypt-secretkey-file=1.key --provider-cert-file=1.cert</pre><h3></h3><h3></h3><h3>Conectarse desde un equipo cliente al servidor</h3><p>Tenemos que compilar en nuestra maquina dnscrypt-proxy tal y como hemos indicado en el apartado <em>&#8220;Compilar cliente dnscrypt&#8221;</em>. Una vez compilado e instalado en el sistema tendremos que ejecutar en una terminal esto:</p><pre> # dnscrypt-proxy --local-address=127.0.0.2:53 --resolver-address=37.228.134.139:443 --provider-name=2.dnscrypt-cert.bash-street-boys-and-girls.com --provider-key=B67F:1944:2110:E41F:542C:CB37:5D01:5A83:E793:2B91:45AA:5DE8:7E23:3317:1855:BC53</pre><p>Para probar que resuelve podemos hacerlo así:</p><pre> # dig -p 53 elbinario.net @127.0.0.2
</pre><p>Finalmente en /etc/resolv.conf pondremos nameserver 127.0.0.2 y tendría que resolver pasando por el dnscrypt.</p><p>&nbsp;</p><h3>Lista de proveedores de servicio dnscrypt</h3><p>Aquí pueden verse: <a href="https://github.com/jedisct1/dnscrypt-proxy/blob/master/dnscrypt-resolvers.csv#L2">https://github.com/jedisct1/dnscrypt-proxy/blob/master/dnscrypt-resolvers.csv#L2</a></p><div class='rp4wp-related-posts'><h3>Más mierda posiblemente relacionada</h3><ul><li><div class='rp4wp-related-post-content'> <a href='https://mierda.tv/2018/01/11/doom-the-roguelike-y-freedoom/'>DOOM: The Roguelike y Freedoom</a><p>DOOM: The Roguelike Este juego la verdad es que es curioso y llamativo al mismo&hellip;</p></div></li><li><div class='rp4wp-related-post-content'> <a href='https://mierda.tv/2018/02/20/nina-simone-in-concert-de-vinilo-a-flac/'>Nina Simone in Concert - De vinilo a flac</a><p>Este vinilo es un concierto de Nina Simone. La cara a contiene: - I loves&hellip;</p></div></li><li><div class='rp4wp-related-post-content'> <a href='https://mierda.tv/2018/05/27/all-aboard-the-impure-train-demoscene/'>All aboard the impure train ! - Demoscene</a><p>Con los años quizás nos demos cuenta del mal que nos trajo el auto-tune y&hellip;</p></div></li></ul></div></div><div class="meta bottom section-inner"><p class="tags"> #<a href="https://mierda.tv/tag/cifrar-peticiones-dns/" rel="tag">cifrar peticiones dns</a> #<a href="https://mierda.tv/tag/dnscrypt/" rel="tag">dnscrypt</a> #<a href="https://mierda.tv/tag/dnscrypt-howto/" rel="tag">dnscrypt howto</a></p></div><div class="post-pagination section-inner"><div class="previous-post"> <a href="https://mierda.tv/2016/08/04/10-reacciones-de-administradoresas-de-sistemas/" rel="prev"><span>10 reacciones de administradores/as de sistemas</span></a></div><div class="next-post"> <a href="https://mierda.tv/2016/08/05/rdesktop-control-remoto-de-maquinas-windows/" rel="next"><span>Rdesktop &#8211; Control remoto de máquinas windows</span></a></div></div><div class="section-inner wide"><div id="respond" class="comment-respond"><h3 id="reply-title" class="comment-reply-title">Deja un comentario <small><a rel="nofollow" id="cancel-comment-reply-link" href="/2016/08/05/dnscrypt-in-the-night/#respond" style="display:none;">Cancelar respuesta</a></small></h3><form action="https://mierda.tv/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><p class="comment-form-comment"><label for="comment">Comentario</label><textarea autocomplete="nope"  id="47848ae093"  name="47848ae093"   cols="45" rows="8" maxlength="65525" required="required"></textarea><textarea id="comment" aria-hidden="true" name="comment" autocomplete="nope" style="padding:0;clip:rect(1px, 1px, 1px, 1px);position:absolute !important;white-space:nowrap;height:1px;width:1px;overflow:hidden;" tabindex="-1"></textarea><script type="text/javascript">document.getElementById("comment").setAttribute( "id", "702c28721be18ae570201ab0afe1cd6b" );document.getElementById("47848ae093").setAttribute( "id", "comment" );</script></p><p class="comment-form-author"><label for="author">Nombre <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" required='required' /></p><p class="comment-form-email"><label for="email">Correo electrónico <span class="required">*</span></label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" aria-describedby="email-notes" required='required' /></p><p class="comment-form-url"><label for="url">Web</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200" /></p><p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Publicar comentario" /> <input type='hidden' name='comment_post_ID' value='466' id='comment_post_ID' /> <input type='hidden' name='comment_parent' id='comment_parent' value='0' /></p></form></div></div></div><footer class="site-footer section-inner"><p class="copyright">&copy; 2018 <a href="https://mierda.tv" class="site-name">[ MIERDA TV ]</a></p></footer></main> <script type="text/javascript">jQuery(document).ready( function() { jQuery.post( "https://mierda.tv/wp-admin/admin-ajax.php", { action : "entry_views", _ajax_nonce : "70537a5d8f", post_id : 466 } ); } );</script> <script type='text/javascript'>var es_widget_page_notices = {"es_email_notice":"Por favor introduce direcci\u00f3n de correo electr\u00f3nico","es_success_message":"Suscripci\u00f3n correcta.","es_success_notice":"\u00a1Suscripci\u00f3n correcta! Consulta tu bandeja de entrada y confirma tu suscripci\u00f3n. Si no ves el correo en unos minutos, consulta la carpeta spam\/correo no deseado.","es_email_exists":"\u00a1Esa direcci\u00f3n de correo electr\u00f3nico ya existe!","es_error":"Ups. Ha sucedido un error inesperado.","es_invalid_email":"Direcci\u00f3n de correo electr\u00f3nico no v\u00e1lida","es_try_later":"Por favor, int\u00e9ntalo transcurridos unos minutos","es_ajax_url":"https:\/\/mierda.tv\/wp-admin\/admin-ajax.php"};</script> <script type='text/javascript'>var mcluhan_ajaxpagination = {"ajaxurl":"https:\/\/mierda.tv\/wp-admin\/admin-ajax.php","query_vars":"{\"page\":\"\",\"year\":\"2016\",\"monthnum\":\"08\",\"day\":\"05\",\"name\":\"dnscrypt-in-the-night\"}"};</script> <script type="text/javascript" defer src="https://mierda.tv/wp-contenido/cache/autoptimize/js/autoptimize_0f440c40192207511c15447e1fc97710.js"></script></body></html>